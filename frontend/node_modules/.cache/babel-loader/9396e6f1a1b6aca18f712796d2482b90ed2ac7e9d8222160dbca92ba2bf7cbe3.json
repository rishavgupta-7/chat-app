{"ast":null,"code":"var _jsxFileName = \"D:\\\\MERN\\\\projects\\\\Social-media\\\\frontend\\\\src\\\\pages\\\\Chat.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { io } from \"socket.io-client\";\n// import OnlineStatus from \"../components/OnlineStatus\"; // Assuming you have this\nimport axios from \"axios\";\n\n// A simple placeholder for your OnlineStatus component\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OnlineStatus = ({\n  user\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    padding: '10px 0',\n    borderBottom: '1px solid #eee',\n    marginBottom: 10\n  },\n  children: [\"Logged in as: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n    children: user === null || user === void 0 ? void 0 : user.phoneNumber\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 9,\n    columnNumber: 19\n  }, this), \" (ID: \", user === null || user === void 0 ? void 0 : user.id, \")\"]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 8,\n  columnNumber: 3\n}, this);\n_c = OnlineStatus;\nexport default function Chat({\n  user\n}) {\n  _s();\n  const [socket, setSocket] = useState(null);\n  const [text, setText] = useState(\"\");\n  const [receiverPhone, setReceiverPhone] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const messagesEndRef = useRef(null);\n\n  // This state will hold the ID of the person we are actively chatting with\n  const [activeReceiverId, setActiveReceiverId] = useState(null);\n  const [chatPartner, setChatPartner] = useState(null); // Store info about the receiver\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  // --- 1. Auto-scroll logic ---\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n  useEffect(scrollToBottom, [messages]);\n\n  // --- 2. Socket.io Connection ---\n  useEffect(() => {\n    // Only connect if we have a user object\n    if (!(user !== null && user !== void 0 && user.id)) return;\n    const token = localStorage.getItem(\"token\");\n    if (!token) {\n      console.error(\"No auth token found. User cannot connect.\");\n      return;\n    }\n    const newSocket = io(\"http://localhost:5000\", {\n      transports: [\"websocket\"],\n      auth: {\n        token: token\n      }\n    });\n    newSocket.on(\"connect\", () => {\n      console.log(\"âœ… Connected to socket:\", newSocket.id);\n      setSocket(newSocket);\n    });\n    newSocket.on(\"disconnect\", () => {\n      console.log(\"ðŸ”´ Disconnected from socket\");\n      setSocket(null);\n    });\n\n    // Main event listener for new messages\n    newSocket.on(\"receiveMessage\", msg => {\n      console.log(\"Received message:\", msg);\n      // We only want to add the message if it's part of the currently active chat\n      if (msg.senderId === activeReceiverId || msg.senderId === user.id) {\n        setMessages(prev => [...prev, msg]);\n      } else {\n        // Optional: Handle notifications for messages from other users\n        console.log(\"Received a message from another user:\", msg.senderId);\n      }\n    });\n\n    // Listen for errors from the server (like \"User not found\")\n    newSocket.on(\"messageError\", err => {\n      console.error(\"Server error:\", err.error);\n      setError(err.error);\n      // Here you could remove an optimistic message if you implemented that\n    });\n\n    // Cleanup on component unmount\n    return () => {\n      console.log(\"Cleaning up socket connection...\");\n      newSocket.disconnect();\n    };\n  }, [user, activeReceiverId]); // Re-run if user or activeReceiverId changes\n\n  // --- 3. Function to Load a Chat Session ---\n  const loadChatSession = async () => {\n    if (!receiverPhone) return setError(\"Please enter a phone number.\");\n    if (receiverPhone === user.phoneNumber) return setError(\"You cannot chat with yourself.\");\n    setIsLoading(true);\n    setError(\"\");\n    setMessages([]); // Clear old messages\n    setActiveReceiverId(null);\n    setChatPartner(null);\n    try {\n      const token = localStorage.getItem(\"token\");\n      if (!token) throw new Error(\"No auth token found\");\n\n      // 1. Find the user by their phone number\n      const findUserRes = await axios.get(`http://localhost:5000/api/auth/findByPhone/${receiverPhone}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        } // Secure this route\n      });\n      const receiver = findUserRes.data;\n      if (!(receiver !== null && receiver !== void 0 && receiver._id)) throw new Error(\"User not found.\");\n      setChatPartner(receiver);\n      setActiveReceiverId(receiver._id);\n\n      // 2. Fetch the message history (Securely!)\n      const messagesRes = await axios.get(`http://localhost:5000/api/messages/${receiver._id}`,\n      // Pass other user's ID\n      {\n        headers: {\n          Authorization: `Bearer ${token}`\n        } // Send our token for auth\n        // No more ?currentUserId=... query param!\n      });\n      setMessages(messagesRes.data);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      const errMsg = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || err.message;\n      console.error(\"Failed to load chat:\", errMsg);\n      setError(errMsg);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // --- 4. Function to Send a New Message ---\n  const sendMessage = async () => {\n    // We only need to check for text and an active chat session\n    if (!text) return;\n    if (!activeReceiverId) return setError(\"Please load a chat session first.\");\n    if (!socket) return setError(\"Socket not connected.\");\n\n    // Emit the message. The receiverPhone is still needed by the backend.\n    socket.emit(\"sendMessage\", {\n      receiverPhone: chatPartner.phoneNumber,\n      // Send the phone number from the loaded chat partner\n      text: text\n    });\n\n    // We don't need to optimistically update, because the server\n    // will send the message right back to us via \"receiveMessage\"\n    // which we are already listening for.\n    setText(\"\");\n  };\n\n  // --- 5. Render ---\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 400,\n      margin: \"auto\",\n      padding: 20,\n      fontFamily: \"sans-serif\",\n      background: \"#f9f9f9\",\n      borderRadius: 8,\n      boxShadow: \"0 4px 12px rgba(0,0,0,0.05)\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(OnlineStatus, {\n      user: user\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        textAlign: \"center\",\n        color: \"#333\",\n        borderBottom: '1px solid #eee',\n        paddingBottom: 10\n      },\n      children: \"Chat App\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: 10,\n        display: \"flex\",\n        gap: 6\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: receiverPhone,\n        onChange: e => setReceiverPhone(e.target.value),\n        placeholder: \"Enter receiver's phone\",\n        style: {\n          flexGrow: 1,\n          padding: 8,\n          borderRadius: 5,\n          border: \"1px solid #ccc\"\n        },\n        disabled: isLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: loadChatSession,\n        disabled: isLoading || !receiverPhone,\n        style: {\n          padding: \"8px 12px\",\n          border: \"none\",\n          borderRadius: 5,\n          background: \"#007bff\",\n          color: \"white\",\n          cursor: \"pointer\"\n        },\n        children: isLoading ? \"Loading...\" : \"Load Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        border: \"1px solid #ccc\",\n        borderRadius: 5,\n        background: \"#fff\",\n        marginBottom: 10,\n        height: 350,\n        display: \"flex\",\n        flexDirection: \"column\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 10,\n          borderBottom: \"1px solid #eee\",\n          background: \"#fafafa\"\n        },\n        children: chatPartner ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Chatting with: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: chatPartner.phoneNumber\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: \"#888\",\n            textAlign: \"center\"\n          },\n          children: \"No chat loaded\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flexGrow: 1,\n          overflowY: \"auto\",\n          padding: 10\n        },\n        children: [error && /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            textAlign: \"center\",\n            color: \"red\"\n          },\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 21\n        }, this), !error && messages.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            textAlign: \"center\",\n            color: \"#999\"\n          },\n          children: chatPartner ? \"Say hello!\" : \"Enter a phone number to start chatting.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 13\n        }, this), messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: m.senderId === user.id ? \"right\" : \"left\",\n            marginBottom: 6\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              display: \"inline-block\",\n              background: m.senderId === user.id ? \"#dcf8c6\" : \"#e5e5ea\",\n              color: \"#333\",\n              padding: \"8px 12px\",\n              borderRadius: 12,\n              maxWidth: \"80%\",\n              wordBreak: \"break-word\",\n              boxShadow: \"0 1px 1px rgba(0,0,0,0.05)\"\n            },\n            children: m.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 15\n          }, this)\n        }, m._id || `temp-${m.createdAt}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        gap: 6\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: text,\n        onChange: e => setText(e.target.value),\n        onKeyPress: e => e.key === 'Enter' && sendMessage(),\n        placeholder: \"Type a message...\",\n        style: {\n          flexGrow: 1,\n          padding: 8,\n          borderRadius: 5,\n          border: \"1px solid #ccc\"\n        },\n        disabled: !activeReceiverId || !socket // Disable until a chat is loaded\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: sendMessage,\n        disabled: !activeReceiverId || !socket || !text,\n        style: {\n          padding: \"8px 12px\",\n          border: \"none\",\n          borderRadius: 5,\n          background: socket && activeReceiverId ? \"#4CAF50\" : \"#999\",\n          color: \"white\",\n          cursor: socket && activeReceiverId ? \"pointer\" : \"not-allowed\"\n        },\n        children: socket ? \"Send\" : \"Connecting...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 154,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"D5Q73C+wUXVqYaAj46ZVYCgnc60=\");\n_c2 = Chat;\nvar _c, _c2;\n$RefreshReg$(_c, \"OnlineStatus\");\n$RefreshReg$(_c2, \"Chat\");","map":{"version":3,"names":["React","useEffect","useState","useRef","io","axios","jsxDEV","_jsxDEV","OnlineStatus","user","style","padding","borderBottom","marginBottom","children","phoneNumber","fileName","_jsxFileName","lineNumber","columnNumber","id","_c","Chat","_s","socket","setSocket","text","setText","receiverPhone","setReceiverPhone","messages","setMessages","messagesEndRef","activeReceiverId","setActiveReceiverId","chatPartner","setChatPartner","isLoading","setIsLoading","error","setError","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","token","localStorage","getItem","console","newSocket","transports","auth","on","log","msg","senderId","prev","err","disconnect","loadChatSession","Error","findUserRes","get","headers","Authorization","receiver","data","_id","messagesRes","_err$response","_err$response$data","errMsg","response","message","sendMessage","emit","maxWidth","margin","fontFamily","background","borderRadius","boxShadow","textAlign","color","paddingBottom","display","gap","type","value","onChange","e","target","placeholder","flexGrow","border","disabled","onClick","cursor","height","flexDirection","overflowY","length","map","m","wordBreak","createdAt","ref","onKeyPress","key","_c2","$RefreshReg$"],"sources":["D:/MERN/projects/Social-media/frontend/src/pages/Chat.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\n// import OnlineStatus from \"../components/OnlineStatus\"; // Assuming you have this\r\nimport axios from \"axios\";\r\n\r\n// A simple placeholder for your OnlineStatus component\r\nconst OnlineStatus = ({ user }) => (\r\n  <div style={{ padding: '10px 0', borderBottom: '1px solid #eee', marginBottom: 10 }}>\r\n    Logged in as: <strong>{user?.phoneNumber}</strong> (ID: {user?.id})\r\n  </div>\r\n);\r\n\r\nexport default function Chat({ user }) {\r\n  const [socket, setSocket] = useState(null);\r\n  const [text, setText] = useState(\"\");\r\n  const [receiverPhone, setReceiverPhone] = useState(\"\");\r\n  const [messages, setMessages] = useState([]);\r\n  const messagesEndRef = useRef(null);\r\n  \r\n  // This state will hold the ID of the person we are actively chatting with\r\n  const [activeReceiverId, setActiveReceiverId] = useState(null);\r\n  const [chatPartner, setChatPartner] = useState(null); // Store info about the receiver\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  // --- 1. Auto-scroll logic ---\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n  useEffect(scrollToBottom, [messages]);\r\n\r\n  // --- 2. Socket.io Connection ---\r\n  useEffect(() => {\r\n    // Only connect if we have a user object\r\n    if (!user?.id) return;\r\n\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      console.error(\"No auth token found. User cannot connect.\");\r\n      return;\r\n    }\r\n\r\n    const newSocket = io(\"http://localhost:5000\", {\r\n      transports: [\"websocket\"],\r\n      auth: { token: token },\r\n    });\r\n\r\n    newSocket.on(\"connect\", () => {\r\n      console.log(\"âœ… Connected to socket:\", newSocket.id);\r\n      setSocket(newSocket);\r\n    });\r\n\r\n    newSocket.on(\"disconnect\", () => {\r\n      console.log(\"ðŸ”´ Disconnected from socket\");\r\n      setSocket(null);\r\n    });\r\n\r\n    // Main event listener for new messages\r\n    newSocket.on(\"receiveMessage\", (msg) => {\r\n      console.log(\"Received message:\", msg);\r\n      // We only want to add the message if it's part of the currently active chat\r\n      if (msg.senderId === activeReceiverId || msg.senderId === user.id) {\r\n        setMessages((prev) => [...prev, msg]);\r\n      } else {\r\n        // Optional: Handle notifications for messages from other users\r\n        console.log(\"Received a message from another user:\", msg.senderId);\r\n      }\r\n    });\r\n\r\n    // Listen for errors from the server (like \"User not found\")\r\n    newSocket.on(\"messageError\", (err) => {\r\n      console.error(\"Server error:\", err.error);\r\n      setError(err.error);\r\n      // Here you could remove an optimistic message if you implemented that\r\n    });\r\n\r\n    // Cleanup on component unmount\r\n    return () => {\r\n      console.log(\"Cleaning up socket connection...\");\r\n      newSocket.disconnect();\r\n    };\r\n  }, [user, activeReceiverId]); // Re-run if user or activeReceiverId changes\r\n\r\n  // --- 3. Function to Load a Chat Session ---\r\n  const loadChatSession = async () => {\r\n    if (!receiverPhone) return setError(\"Please enter a phone number.\");\r\n    if (receiverPhone === user.phoneNumber) return setError(\"You cannot chat with yourself.\");\r\n\r\n    setIsLoading(true);\r\n    setError(\"\");\r\n    setMessages([]); // Clear old messages\r\n    setActiveReceiverId(null);\r\n    setChatPartner(null);\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) throw new Error(\"No auth token found\");\r\n\r\n      // 1. Find the user by their phone number\r\n      const findUserRes = await axios.get(\r\n        `http://localhost:5000/api/auth/findByPhone/${receiverPhone}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` } // Secure this route\r\n        }\r\n      );\r\n      \r\n      const receiver = findUserRes.data;\r\n      if (!receiver?._id) throw new Error(\"User not found.\");\r\n      \r\n      setChatPartner(receiver);\r\n      setActiveReceiverId(receiver._id);\r\n\r\n      // 2. Fetch the message history (Securely!)\r\n      const messagesRes = await axios.get(\r\n        `http://localhost:5000/api/messages/${receiver._id}`, // Pass other user's ID\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` } // Send our token for auth\r\n          // No more ?currentUserId=... query param!\r\n        }\r\n      );\r\n\r\n      setMessages(messagesRes.data);\r\n      \r\n    } catch (err) {\r\n      const errMsg = err.response?.data?.message || err.message;\r\n      console.error(\"Failed to load chat:\", errMsg);\r\n      setError(errMsg);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // --- 4. Function to Send a New Message ---\r\n  const sendMessage = async () => {\r\n    // We only need to check for text and an active chat session\r\n    if (!text) return;\r\n    if (!activeReceiverId) return setError(\"Please load a chat session first.\");\r\n    if (!socket) return setError(\"Socket not connected.\");\r\n\r\n    // Emit the message. The receiverPhone is still needed by the backend.\r\n    socket.emit(\"sendMessage\", { \r\n      receiverPhone: chatPartner.phoneNumber, // Send the phone number from the loaded chat partner\r\n      text: text \r\n    });\r\n\r\n    // We don't need to optimistically update, because the server\r\n    // will send the message right back to us via \"receiveMessage\"\r\n    // which we are already listening for.\r\n    setText(\"\");\r\n  };\r\n\r\n  // --- 5. Render ---\r\n  return (\r\n    <div style={{ maxWidth: 400, margin: \"auto\", padding: 20, fontFamily: \"sans-serif\", background: \"#f9f9f9\", borderRadius: 8, boxShadow: \"0 4px 12px rgba(0,0,0,0.05)\" }}>\r\n      <OnlineStatus user={user} />\r\n\r\n      <h2 style={{ textAlign: \"center\", color: \"#333\", borderBottom: '1px solid #eee', paddingBottom: 10 }}>Chat App</h2>\r\n\r\n      {/* -- Phone Number Input -- */}\r\n      <div style={{ marginBottom: 10, display: \"flex\", gap: 6 }}>\r\n        <input\r\n          type=\"text\"\r\n          value={receiverPhone}\r\n          onChange={(e) => setReceiverPhone(e.target.value)}\r\n          placeholder=\"Enter receiver's phone\"\r\n          style={{ flexGrow: 1, padding: 8, borderRadius: 5, border: \"1px solid #ccc\" }}\r\n          disabled={isLoading}\r\n        />\r\n        <button \r\n          onClick={loadChatSession} \r\n          disabled={isLoading || !receiverPhone}\r\n          style={{ padding: \"8px 12px\", border: \"none\", borderRadius: 5, background: \"#007bff\", color: \"white\", cursor: \"pointer\" }}\r\n        >\r\n          {isLoading ? \"Loading...\" : \"Load Chat\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* -- Chat Header & Message Box -- */}\r\n      <div style={{ border: \"1px solid #ccc\", borderRadius: 5, background: \"#fff\", marginBottom: 10, height: 350, display: \"flex\", flexDirection: \"column\" }}>\r\n        \r\n        {/* Chat Header */}\r\n        <div style={{ padding: 10, borderBottom: \"1px solid #eee\", background: \"#fafafa\" }}>\r\n          {chatPartner ? (\r\n            <div>Chatting with: <strong>{chatPartner.phoneNumber}</strong></div>\r\n          ) : (\r\n            <div style={{ color: \"#888\", textAlign: \"center\" }}>No chat loaded</div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Message Area */}\r\n        <div style={{ flexGrow: 1, overflowY: \"auto\", padding: 10 }}>\r\n          {error && <p style={{ textAlign: \"center\", color: \"red\" }}>{error}</p>}\r\n          {!error && messages.length === 0 && (\r\n            <p style={{ textAlign: \"center\", color: \"#999\" }}>\r\n              {chatPartner ? \"Say hello!\" : \"Enter a phone number to start chatting.\"}\r\n            </p>\r\n          )}\r\n          \r\n          {messages.map((m) => (\r\n            <div key={m._id || `temp-${m.createdAt}`} style={{ textAlign: m.senderId === user.id ? \"right\" : \"left\", marginBottom: 6 }}>\r\n              <span style={{ \r\n                display: \"inline-block\", \r\n                background: m.senderId === user.id ? \"#dcf8c6\" : \"#e5e5ea\", \r\n                color: \"#333\",\r\n                padding: \"8px 12px\", \r\n                borderRadius: 12, \r\n                maxWidth: \"80%\", \r\n                wordBreak: \"break-word\",\r\n                boxShadow: \"0 1px 1px rgba(0,0,0,0.05)\"\r\n              }}>\r\n                {m.text}\r\n              </span>\r\n            </div>\r\n          ))}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* -- Message Input Box -- */}\r\n      <div style={{ display: \"flex\", gap: 6 }}>\r\n        <input\r\n          type=\"text\"\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\r\n          placeholder=\"Type a message...\"\r\n          style={{ flexGrow: 1, padding: 8, borderRadius: 5, border: \"1px solid #ccc\" }}\r\n          disabled={!activeReceiverId || !socket} // Disable until a chat is loaded\r\n        />\r\n        <button \r\n          onClick={sendMessage} \r\n          disabled={!activeReceiverId || !socket || !text} \r\n          style={{ \r\n            padding: \"8px 12px\", \r\n            border: \"none\", \r\n            borderRadius: 5, \r\n            background: (socket && activeReceiverId) ? \"#4CAF50\" : \"#999\", \r\n            color: \"white\", \r\n            cursor: (socket && activeReceiverId) ? \"pointer\" : \"not-allowed\" \r\n          }}\r\n        >\r\n          {socket ? \"Send\" : \"Connecting...\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}